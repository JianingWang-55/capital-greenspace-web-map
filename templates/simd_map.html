<!DOCTYPE html>
<!--
  simd_map.html
  
  Greenspace & Deprivation Explorer

  Purpose:
  - Visualises the spatial relationship between public greenspaces (parks) and
    socio-economic deprivation across the City of Edinburgh.
  - Enables users to explore how greenspace distribution and characteristics
    relate to SIMD (Scottish Index of Multiple Deprivation) deciles.

  Key Features:
  - Interactive Leaflet-based map with selectable base maps:
      * OpenStreetMap
      * Google Satellite imagery
  - Overlay layers:
      * SIMD 2020 data for the City of Edinburgh (choropleth by decile).
      * Greenspace polygons/points representing parks.
  - Dynamic legend for SIMD deciles, updating with layer visibility.
  - Sidebar accordion interface for clear layer and legend control.

  Data & Integration:
  - Uses Flask/Jinja2 to inject backend data:
      * `parks`: park attributes and geometries used for the greenspace layer.
  - Loads SIMD spatial data from a static GeoJSON file:
      * `static/simd_edinburgh_cleaned.geojson`
  - Map logic and layer handling are implemented in:
      * `static/js/simd_map.js`
  - Styling and layout are handled by:
      * `static/css/simd_map.css`

  Notes:
  - Designed for academic analysis and public exploration of deprivation patterns
    in relation to greenspace availability.
  - Intended as a contextual overview map complementing the interactive search
    and network analysis tools within the wider project.
-->
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greenspace & Deprivation Explorer</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/simd_map.css') }}">
</head>
<body>

<div id="loading-overlay">
    <div class="spinner"></div>
    <p style="margin-top: 10px; font-weight: bold; color: var(--primary-color);">Loading Data...</p>
</div>

<div class="layout-wrapper">
    
    <div class="sidebar">
        <div class="sidebar-header">
            <h2><i class="fa-solid fa-layer-group"></i> Greenspace & Deprivation Explorer</h2>
            <a href="{{ url_for('user_guide') }}#simd" target="_blank" class="btn-help-header" title="Help / User Guide">
                <i class="fa-solid fa-circle-question"></i>
            </a>
        </div>
        
        <div class="sidebar-content">
            
            <div class="accordion-item">
                <div class="accordion-header active">
                    <span><i class="fa-solid fa-map"></i> Map Layers</span>
                </div>
                <div class="accordion-body open">
                    
                    <div class="control-group">
                        <label class="control-label">Base Map</label>
                        <div class="radio-option">
                            <input type="radio" name="basemap" id="base-osm" checked>
                            <label for="base-osm">OpenStreetMap</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" name="basemap" id="base-sat">
                            <label for="base-sat">Google Satellite</label>
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">Overlays</label>
                        <div class="check-option">
                            <input type="checkbox" id="layer-simd">
                            <label for="layer-simd">City of Edinburgh SIMD 2020 Data</label>
                        </div>
                        <div class="check-option">
                            <input type="checkbox" id="layer-green" checked>
                            <label for="layer-green">Greenspaces (Parks)</label>
                        </div>
                    </div>

                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header active">
                    <span><i class="fa-solid fa-list"></i> SIMD Decile</span>
                </div>
                <div class="accordion-body open">
                    <div id="simd-legend-content" class="legend-container">
                        </div>
                </div>
            </div>

        </div>
        
        <div class="sidebar-footer">
            <a href="{{ url_for('index') }}" class="btn btn-grey-small">
                <i class="fa-solid fa-house"></i> Back to Home
            </a>
        </div>
    </div>

    <div id="map-container">
        <div id="map"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<script>
    const SIMD_GEOJSON_URL = "{{ url_for('static', filename='simd_edinburgh_cleaned.geojson') }}";
    const parksData = {{ parks | tojson }};
</script>

<script src="{{ url_for('static', filename='js/simd_map.js') }}"></script>

</body>
</html>